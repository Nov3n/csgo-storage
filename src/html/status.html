<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="../css/csgoItem.css" />
    <title>Document</title>
</head>

<body style="background-image: url(../img/status_background.jpg);background-size:100% 100%;">
    <!--头像-->
    <div>
        <img id="avatar" src="" style="border-radius: 20%;width: 100px;height: 100px;">
        <textarea id="account"
            style="background-color: aliceblue;color:blue;resize:none;font-size:larger;font-weight:bolder" cols="15"
            rows="1"></textarea>
    </div>
    <!--显示库存批量内容-->
    <div id="statusDiv">
        <h1 style="background-color: darkkhaki;width: 530px;">库存内容</h1>
        <textarea id="statusDivText" readonly="true" style="width: 525px;height: 200px;" rows="20"
            style="font-size:100px;" placeholder="空"></textarea>
    </div>
    <div id="moveTaskDiv">
        <h1 style="background-color: darkkhaki;width: 530px;">移动任务队列</h1>
        <textarea id="moveinTaskDivText" readonly="true" cols="23" rows="1" placeholder="移入库存剩余任务数："
            style="resize: none;"></textarea>
        <textarea id="moveoutTaskDivText" readonly="true" cols="23" rows="1" placeholder="移出库存剩余任务数："
            style="resize: none;"></textarea>
        <textarea id="executingTaskDivText" readonly="true" cols="19" rows="1" placeholder="当前执行任务数："
            style="resize: none;"></textarea>
    </div>
    <div id="storageOpDiv" title="批量移动操作">
        <h1 style="background-color: darkkhaki;width: 530px;">移动操作</h1>
        <form>
            <input style="width: 100px;" id="storageOpDefIndex" type="text" placeholder="物品索引" />
            <input style="width: 100px;" id="storageOpNum" type="text" placeholder="数量" />
            <select id="storageOpTradable" value="1" style="width: 100px;">
                <option value="0">不可交易</option>
                <option value="1">可交易</option>
                <option value="2">不限</option>
            </select>
            <select id="storageOp" value="1" style="width: 100px;">
                <option value="1">移入组件</option>
                <option value="2">移出组件</option>
            </select>
            <button onclick="ItemMove()" type="button">确认</button>
        </form>
    </div>

    <!-- 自动移入组件的条件 -->
    <div id="autoMoveinDiv">
        <h1 style="background-color: darkkhaki;width: 530px;">自动移入条件</h1>

        <!-- 添加条件的操作块 -->
        <p id="addAutoMoveinCond">
            <input style="width: 100px;" id="autoMoveinDefIndex" type="text" placeholder="物品索引" />
            <select id="autoMoveinTradable" value="1" style="width: 100px;">
                <option value="0">不可交易</option>
                <option value="1">可交易</option>
                <option value="2">不限</option>
            </select>
            <button onclick="AddAutoMoveinCond()" type="button">添加</button>
        </p>

        <!-- 添加的条件块 -->
        <p id=autoMoveinConditions>
        </p>

    </div>
    <button onclick="ExitCsgo()" type="button" style="background-color: green;width: 100px;">退出游戏</button>

    <script>
        const { ipcRenderer } = require('electron'); // 引入进程通信模块
        var autoMoveinCondMap = new Map();
        var autoMoveinCounter = 0;

        function ItemMove() {
            let defIndex = document.getElementById("storageOpDefIndex");
            let moveNum = document.getElementById("storageOpNum");
            let tradable = document.getElementById("storageOpTradable");
            let storageOp = document.getElementById("storageOp");
            if (storageOp.value === "1") {
                ipcRenderer.send('moveinTask', Number(defIndex.value), Number(tradable.value), Number(moveNum.value));
                console.log("storageOp=1");
            } else if (storageOp.value === "2") {
                ipcRenderer.send('moveoutTask', Number(defIndex.value), Number(tradable.value), Number(moveNum.value));
                console.log("storageOp=2");
            }
            console.log("确认结束");
        }
        ipcRenderer.on('statusOnTimer', async (event, statusStr) => {
            let ele = document.getElementById("statusDivText");
            ele.value = statusStr;
        });
        ipcRenderer.on('accountInfoOnTimer', async (event, accountInfo) => {
            let ele = document.getElementById("account");
            ele.value = accountInfo.account;
        });
        ipcRenderer.on('moveTaskOnTimer', async (event, moveinTaskSize, moveoutTaskSize, executingTaskSize) => {
            let inEle = document.getElementById("moveinTaskDivText");
            inEle.value = "移入库存剩余任务数：" + moveinTaskSize;
            let outEle = document.getElementById("moveoutTaskDivText");
            outEle.value = "移出库存剩余任务数：" + moveoutTaskSize;
            let execEle = document.getElementById("executingTaskDivText");
            execEle.value = "当前执行任务数：" + executingTaskSize;
        });
        ipcRenderer.on('avatarUrl', async (event, url) => {
            console.log("Status Win Get AvatarUrl:" + url);
            let avatar = document.getElementById("avatar");
            avatar.src = url;
        });


        function AddAutoMoveinCond() {
            let defIndex = Number(document.getElementById("autoMoveinDefIndex").value);
            let tradable = Number(document.getElementById("autoMoveinTradable").value);

            let autoMoveinConditions = document.getElementById("autoMoveinConditions");
            // 创建条件展示块
            let conditionP = document.createElement('p');
            conditionP.id = "autoMoveinCond-" + String(autoMoveinCounter);
            autoMoveinCounter++;

            // 创建展示的defIndex
            let conditionPdefindex = document.createElement('input');
            conditionPdefindex.id = conditionP.id + "DefIndex";
            conditionPdefindex.style = "width: 100px;";
            conditionPdefindex.value = defIndex;
            conditionPdefindex.readOnly = true;

            // 创建展示的tradable
            let conditionPtradable = document.createElement('input');
            conditionPtradable.id = conditionP.id + "Tradable";
            conditionPtradable.style = "width: 100px;";
            conditionPtradable.value = tradable == 0 ? "不可交易" : tradable == 1 ? "可交易" : "不限";
            conditionPtradable.readOnly = true;

            // 创建删除按钮
            let deleteButton = document.createElement('button');
            deleteButton.id = conditionP.id + "DeleteButton";
            deleteButton.value = conditionP.id;
            deleteButton.type = 'button';
            deleteButton.innerText = "删除"
            deleteButton.addEventListener('click', () => {
                autoMoveinConditions.removeChild(conditionP);
                autoMoveinCondMap.delete(conditionP.id);
            });

            conditionP.appendChild(conditionPdefindex);
            conditionP.appendChild(conditionPtradable);
            conditionP.appendChild(deleteButton);
            autoMoveinConditions.appendChild(conditionP);
            autoMoveinCondMap.set(conditionP.id, { defIndex: defIndex, tradable: tradable });
        }

        function ExitCsgo() {
            ipcRenderer.send('exitCsgo');
        }


        function SendAutoMoveinConds() {
            ipcRenderer.send('autoMoveinCond', autoMoveinCondMap);
        }

        setInterval(() => {
            SendAutoMoveinConds();
        }, 3000);
    </script>
</body>

</html>